<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="kr.kh.finalproject.dao.BagDAO">
	<resultMap type="kr.kh.finalproject.vo.Option_ChoiceVO" id="optionChoice">
	    <id property="oc_num" column="oc_num" />
	    <result property="oc_selected" column="oc_selected" />
	    <result property="oc_selected_price" column="oc_selected_price" />
	    <association property="menu" javaType="kr.kh.finalproject.vo.MenuVO">
	        <result property="mn_num" column="mn_num" />
	        <result property="mn_name" column="mn_name" />
	        <result property="mn_contents" column="mn_contents" />
	        <result property="mn_price" column="mn_price" />
	        <result property="mn_st_num" column="mn_st_num" />
	        <result property="mn_mc_num" column="mn_mc_num" />
	        <association property="image" javaType="kr.kh.finalproject.vo.ImageVO">
	            <result property="im_num" column="im_num" />
	            <result property="im_name" column="im_name" />
	            <result property="im_ori_name" column="im_ori_name" />
	            <result property="im_contents" column="im_contents" />
	            <result property="im_tableName" column="im_tableName" />
	            <result property="im_tableNum" column="im_tableNum" />
	        </association>
	    </association>
	 </resultMap>
  	<insert id="selectedOption">
  		insert into `option_choice` (oc_sb_num, oc_mn_num, oc_selected, oc_selected_price)
  		values (#{sb_num}, #{menu_num}, #{selected}, #{total})
  	</insert>
  	<select id="hasBag" resultType="kr.kh.finalproject.vo.Shop_BasketVO">
  		select * from `shop_basket`
  		where sb_me_user_id = "carpcarp"
  	</select>
  	<insert id="makeBag">
  		insert into `shop_basket` sb_me_user_id
  		values "carpcarp"
  	</insert>
  	<select id="bagBunho" resultType="int">
  		select sb_num from shop_basket where sb_me_user_id = "carpcarp"
  	</select>
  	<select id="bagList" resultMap="optionChoice">
		select 
			* 
		from 
			option_choice
		left join 
			`shop_basket` on oc_sb_num = sb_num
		left join 
			`menu` on oc_mn_num = mn_num
		left join 
			`image` on oc_mn_num = image.im_tableNum
		where 
			sb_me_user_id = "carpcarp"
  	</select>
  	<delete id="deleteItem" parameterType="int">
  		delete from `option_choice` where oc_num = #{oc_num}
  	</delete>
  	<select id="getShopInfo" resultType="kr.kh.finalproject.vo.ShopVO">
  		select
  			bm_id, bm_pw, bm_num, bm_phone, bm_contents, bm_address, bm_geocoding_lati, bm_geocoding_longi, bm_manager, bm_store_name, bm_image, bm_approval
		from 
			option_choice
		left join 
			 `shop_basket` on oc_sb_num = sb_num
		left join 
			`menu` on oc_mn_num = mn_num
		left join 
			`store` on mn_st_num = st_num
		left join
			`business_member` on st_bm_id = bm_id
		where 
			sb_me_user_id = "carpcarp"
	</select>
  	<update id="givePoint">
  		update `member`
  		set me_point += #{point}
  		where me_user_id = #{user}
  	</update>
  </mapper>